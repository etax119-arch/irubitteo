# 관리자 대시보드 기능 명세

> 참조: `durubitteo_design/src/AdminDashboard.jsx`

## 개요

이루빛터 플랫폼 관리자가 사용하는 중앙 관리 시스템. 전체 회원사 및 근로자 현황 파악, 출퇴근 관리, 통계 조회, 문의 처리 기능 제공.

---

## 구현 상태

**구현 완료** (2026-02-05)

### 라우트 구조

```
/app/admin/
├── layout.tsx              # 헤더 + 6개 탭 네비게이션 (Link 기반)
├── page.tsx                # → /admin/dashboard 리다이렉트
├── _components/
│   ├── AdminStatCard.tsx   # 통계 카드 (badge 지원)
│   ├── CompanyAttendanceAccordion.tsx  # 회사별 출퇴근 아코디언
│   ├── CompanyCard.tsx     # 회원사 카드
│   ├── WorkerTable.tsx     # 근로자 테이블 (필터 포함)
│   ├── WorkStatsTable.tsx  # 근무통계 테이블
│   ├── AbsenceAlertList.tsx  # 결근 알림 리스트
│   ├── NoteUpdateAlertList.tsx # 기업 비고 업데이트 알림 리스트
│   ├── InquiryList.tsx     # 기업 문의 리스트
│   ├── AddCompanyModal.tsx # 회원사 추가 모달
│   ├── InquiryDetailModal.tsx  # 문의 상세 모달
│   └── PrintPreviewModal.tsx   # 인쇄 프리뷰 모달
├── dashboard/page.tsx      # 대시보드 탭
├── companies/
│   ├── page.tsx            # 회원사 관리 탭
│   └── [id]/
│       ├── page.tsx        # 회원사 상세
│       ├── _hooks/         # useCompanyDetail, useCompanyFiles
│       └── _components/    # CompanyProfileCard, PMInfoCard, ResignSection, EmployeeListSection, FileSection, ResignModal
├── employees/
│   ├── page.tsx            # 근로자 관리 탭
│   └── [id]/
│       ├── page.tsx        # 근로자 상세
│       ├── _hooks/         # useAdminEmployeeDetail, useAdminAttendanceHistory, useAdminEmployeeFiles
│       └── _components/    # ProfileCard, AdminNoteSection, CompanyNoteSection, ResignInfoSection, AttendanceHistoryTable, WorkInfoSection, DocumentSection, FileUploadModal, WorkTimeEditModal, WorkDoneModal
├── workstats/page.tsx      # 근무 통계 탭
├── notifications/page.tsx  # 알림센터 탭
└── reports/page.tsx        # 리포트 탭
```

### 타입 정의

- `/types/adminDashboard.ts` - Admin 대시보드/통계 타입 정의
- `/types/adminFile.ts` - Admin 파일 타입 정의 (AdminFile, AdminFileCategory)
- `/types/inquiry.ts` - 기업 문의 타입 정의

### API 클라이언트

- `/lib/api/admin.ts` - Admin API (통계, 출퇴근, 월간 통계, 알림, 파일 관리)
- `/lib/api/inquiries.ts` - 기업 문의 API

### URL 구조

| URL | 설명 |
|-----|------|
| `/admin` | `/admin/dashboard`로 리다이렉트 |
| `/admin/dashboard` | 대시보드 탭 |
| `/admin/companies` | 회원사 관리 탭 |
| `/admin/companies/[id]` | 회원사 상세 페이지 |
| `/admin/employees` | 근로자 관리 탭 |
| `/admin/employees/[id]` | 근로자 상세 페이지 |
| `/admin/workstats` | 근무 통계 탭 |
| `/admin/notifications` | 알림센터 탭 |
| `/admin/reports` | 리포트 탭 |

---

## 탭 구성

| 탭 ID | 탭 이름 | 아이콘 | 설명 |
|-------|--------|--------|------|
| dashboard | 대시보드 | TrendingUp | 플랫폼 전체 현황 및 긴급 알림 |
| companies | 회원사 관리 | Building2 | 회원사 목록 조회 및 등록 |
| employees | 근로자 관리 | Users | 전체 근로자 목록 조회 |
| workstats | 근무 통계 | BarChart3 | 회사별 월간 근무 통계 |
| notifications | 알림센터 | Bell | 결근 알림, 기업 문의 |
| reports | 리포트 | FileText | 문서 템플릿 및 통계 리포트 |

---

## 탭별 상세 기능

### 1. 대시보드 탭

**목적**: 플랫폼 전체 현황 한눈에 파악

#### 통계 카드 (4열)
| 카드 | 아이콘 | 색상 | 데이터 | 부가정보 |
|------|--------|------|--------|----------|
| 전체 회원사 | Building2 | 파란색 | {개수}개 | +N 이번달 |
| 전체 근로자 | Users | 주황색 (강조) | {명}명 | +N 이번달 |
| 근무 중 | UserCheck | 녹색 | {명}명 | - |
| 긴급 알림 | AlertCircle | 빨간색 | {건}건 | - |

#### 긴급 알림 섹션
- 우선순위 높은 알림만 표시
- 각 알림: 아이콘, 제목, 날짜, 메시지, "처리하기" 버튼
- "전체보기 →" 링크 (알림센터 탭으로 이동)

**알림 유형**:
- 결근 알림 (크론잡이 출근시간+30분 경과 시 자동 생성한 absent 레코드 조회)
- 신규 기업 문의

#### 회사별 출퇴근 현황

**날짜 선택**:
- 이전/다음 날짜 버튼
- 날짜 선택 input (캘린더)
- 회사명 검색창

**회사별 아코디언**:
- 회사명, 출근 인원 표시 (예: "3/5명 출근")
- 상태별 집계 배지 (출근 전, 근무중, 결근, 휴가, 퇴근, 휴무)

**펼친 테이블 컬럼**:
| 컬럼 | 설명 |
|------|------|
| 이름 | 근로자 이름 (주의 필요 시 경고 아이콘) |
| 전화번호 | 연락처 |
| 상태 | 출근 전 / 근무중 / 결근 / 휴가 / 퇴근 / 휴무 |
| 출근 시간 | 읽기 전용 |
| 퇴근 시간 | 읽기 전용 |
| 업무 내용 | 읽기 전용 |

---

### 2. 회원사 관리 탭

**목적**: 회원사 목록 조회 및 신규 등록

#### 상단 영역
- "회원사 관리" 제목
- 검색창 (회사명 검색)
- "+ 회원사 추가" 버튼

#### 회원사 목록 (카드 형태)
각 회원사 카드:
- 회사명 + 상태 배지 (계약중/비활성)
- 정보 그리드:
  | 항목 | 설명 |
  |------|------|
  | 위치 | 지역 |
  | 근로자 수 | N명 |
  | 계약시작일 | 계약 시작일 |
  | 담당 PM | PM 담당자명 |
- "상세보기" 버튼 → CompanyDetail 화면

#### 회원사 추가 모달

**섹션 1: 회사 기본 정보**
| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| 회사명 | 텍스트 | O | 예: "(주)이루빛 제조" |
| 사업자등록번호 | 텍스트 | O | 000-00-00000 형식 |
| 주소 | 텍스트 | - | 사업장 주소 |
| 계약 시작일 | 날짜 | O | 계약 시작일 |

**섹션 2: 인사 담당자 정보**
| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| 담당자명 | 텍스트 | O | 인사담당자 이름 |
| 연락처 | 전화번호 | O | 010-0000-0000 |
| 이메일 | 이메일 | - | email@company.com |

**섹션 3: 영업 담당자 (PM) 정보**
| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| 담당자 이름 | 텍스트 | O | PM 담당자 이름 |
| 연락처 | 전화번호 | O | 010-0000-0000 |
| 이메일 | 이메일 | O | email@company.com |

**섹션 4: 기업 관리자 계정 설정**
| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| 기업 고유번호 | 텍스트 | O | 기업 대시보드 로그인용 |

- 초기 비밀번호는 자동 생성되어 담당자 이메일로 발송

---

### 3. 근로자 관리 탭

**목적**: 플랫폼 전체 근로자 목록 조회

#### 상단 영역
- "근로자 관리" 제목
- 검색창 (이름, 회사명 검색)
- 필터 버튼

#### 근로자 목록 테이블
| 컬럼 | 설명 |
|------|------|
| 이름 | 아바타 + 이름 |
| 회사 | 소속 회사명 |
| 전화번호 | 연락처 |
| 장애유형 | 예: "지체장애 3급" |
| 고유번호 | 근로자 고유번호 |
| 관리 | "상세보기" → AdminWorkerDetail 화면 |

---

### 4. 근무 통계 탭

**목적**: 회사별 월간 근무 시간 통계 조회, 수정 및 인쇄

#### 상단 영역
- "근무 통계" 제목
- 검색창 (회사명 검색)
- 월 선택 input (기본값: 현재 월, 동적 설정)
- "재계산" 버튼: 선택된 월의 전체 통계를 출퇴근 기록 기반으로 재계산
  - `POST /admin/monthly-stats/calculate` 호출
  - 성공 시 toast: `"{N}명의 통계가 재계산되었습니다."`
  - 실패 시 toast: `"통계 재계산에 실패했습니다."`
  - 계산 중 버튼 비활성화 + 스피너 아이콘 회전

#### 회사별 아코디언
- 회사명, 전체 인원 수
- "인쇄 프리뷰" 버튼

**펼친 테이블 컬럼**:
| 컬럼 | 설명 |
|------|------|
| 이름 | 근로자 이름 |
| 근무요일 | 배지(badge) 형태로 표시 (예: `월` `화` `수` `목` `금`) |
| 출근 일수 | 클릭하여 인라인 수정 가능 |
| 총 근무시간 | 클릭하여 인라인 수정 가능 |

**테이블 푸터**:
- 평균 출근 일수
- 평균 근무시간

#### 인라인 편집 동작

1. 셀 클릭 시 숫자 입력 필드 + 저장(체크)/취소(X) 버튼 표시
2. **Optimistic Update 패턴**:
   - 이전 상태(`prevCompanies`) 저장
   - UI 즉시 반영 (로컬 상태 업데이트)
   - `PATCH /admin/monthly-stats` API 호출
   - 실패 시 이전 상태로 롤백 + toast: `"통계 수정에 실패했습니다."`

#### 인쇄 프리뷰 모달

**상단 헤더**:
- "인쇄 프리뷰" 제목
- "PDF로 저장" 버튼 + "인쇄" 버튼 (둘 다 `window.print()` 호출)
- PM 담당자 정보 바 (회사에 등록된 경우 표시):
  - 담당자 이름 (User 아이콘)
  - 전화번호 (Phone 아이콘)
  - 이메일 (Mail 아이콘 + 복사 버튼)

**테이블**:
- 회사명 + 월 통계 제목
- 컬럼: 이름 | 근무요일 | 출근 일수 | 총 근무시간
- 근무요일: 토글 버튼으로 인쇄용 로컬 편집 가능 (원본 데이터 변경 없음)
- 출근 일수 / 총 근무시간: 클릭하여 인쇄용 로컬 편집 가능
- 푸터: 평균 출근 일수, 평균 근무시간

**하단**:
- 서명란 (기업 대표자, 이루빛터 담당자)
- 시스템명: "이루빛터 중앙 통제 시스템"

---

### 5. 알림센터 탭

**목적**: 긴급 알림 및 기업 문의 처리

#### 기업 비고 업데이트 (상단, 전체 폭)
- 기업/병원이 근로자에 남긴 companyNote 변경 알림
- "확인하기" 버튼 → dismiss API 호출 + 알림 제거 + 근로자 상세 이동
- 기업이 비고를 다시 수정하면 알림 재표시 (companyNoteReadAt 리셋)

#### 2열 그리드 레이아웃

**좌측: 장애인 근로자 결근 알림**
- 목록 아이템:
  - 근로자 이름
  - 상태 배지 (결근)
  - 회사명, 날짜
  - "확인하기" 버튼 → dismiss API 호출 + 알림 제거 + 근로자 상세 이동

**우측: 신규 기업 문의 알림**
- 안내: "홈페이지를 통해 접수된 신규 기업 문의입니다."
- 목록 아이템:
  - 기업명
  - "신규 문의" 배지
  - 대표자, 접수일
  - 문의 요약 (truncate)
  - "문의 확인" 버튼

#### 문의 상세 모달

**기업 정보**:
| 항목 | 내용 |
|------|------|
| 기업명 | 회사명 |
| 대표자 | 대표자명 |
| 전화번호 | 연락처 |
| 이메일 | 이메일 주소 |

**문의 내용**:
- 상세 문의 내용
- 접수일

**버튼**:
- "상담 완료" - 클릭 시 목록에서 제거

---

### 6. 리포트 탭 (파일 저장소)

**목적**: 문서 템플릿 및 통계 리포트 파일 업로드·다운로드·삭제

#### 구현 구조

```
app/admin/reports/
├── page.tsx                    # FileSection 2개 렌더링
├── _hooks/
│   └── useAdminFiles.ts        # 카테고리별 파일 CRUD 상태 관리
└── _components/
    ├── FileSection.tsx         # 섹션 (제목 + 업로드 버튼 + 파일 목록)
    ├── FileListItem.tsx        # 파일 행 (아이콘, 이름, 크기, 날짜, 다운로드/삭제)
    └── FileUploadModal.tsx     # 업로드 모달 (파일 선택 + 이름 + 설명)
```

#### 2열 그리드 레이아웃

**문서 템플릿** (`category: TEMPLATE`):
- 파일 업로드/다운로드/삭제
- 근로계약서, 출근확인서, 동의서 등 자주 사용하는 문서 보관

**통계 리포트** (`category: REPORT`):
- 파일 업로드/다운로드/삭제
- 월별 통계, 정산 리포트 등 생성된 리포트 파일 보관

#### 허용 파일
- PDF, JPEG, PNG, DOCX, XLSX (최대 10MB)

#### API 연동
```
getAdminFiles(category)                    → 파일 목록 조회
uploadAdminFile(file, category, name, desc) → 파일 업로드
deleteAdminFile(fileId)                    → 파일 삭제
```

- Supabase 버킷: `admin-files` (폴더: `templates/`, `reports/`)
- DB 모델: `Template` (category 필드로 구분)

---

## 데이터 흐름

### 입력 데이터
| 항목 | 출처 | 설명 |
|------|------|------|
| 회원사 정보 | 모달 입력 | 신규 회원사 등록 |
| 근무 통계 수정 | 인라인 편집 | 출근일수/근무시간 조정 |

### 출력 데이터
| 항목 | 대상 | 설명 |
|------|------|------|
| 기업 관리자 계정 | 이메일 | 초기 비밀번호 발송 |
| 근무 통계 인쇄물 | 프린터 | 월간 통계 문서 |
| 리포트 | 다운로드/화면 | 각종 통계 자료 |

---

## 기업 문의 처리 흐름

1. 랜딩 페이지에서 기업 문의 제출 (CompanyInquiry)
2. 관리자 대시보드 알림센터에 표시
3. 관리자가 "문의 확인" 클릭하여 상세 조회
4. 상담 진행 후 "상담 완료" 클릭
5. 목록에서 자동 제거

---

## 연관 기능

- 기업 대시보드: 개별 회사 관리 기능
- 직원 대시보드: 근로자 출퇴근 앱
- 랜딩 페이지 > 기업 문의: 문의 접수

---

## 구현 완료 내역

### UI 구현 완료
- [x] 라우트 기반 탭 구조 (URL 북마크/공유 가능, 브라우저 히스토리 지원)
- [x] 대시보드 탭: 통계 카드, 긴급 알림, 회사별 출퇴근 아코디언
- [x] 회원사 관리 탭: 회원사 목록, 검색, 추가 모달
- [x] 회원사 상세 페이지: 기본정보, PM정보, 소속 근로자, 첨부파일
- [x] 근로자 관리 탭: 필터(현재/퇴사/대기자/전체), 검색, 테이블
- [x] 근로자 상세 페이지: 프로필, 출퇴근 기록, 달력 뷰, 문서 관리
- [x] 근무 통계 탭: 회사별 아코디언, 인라인 수정, 인쇄 프리뷰 모달
- [x] 알림센터 탭: 결근 알림, 기업 문의, 상세 모달
- [x] 리포트 탭: 파일 저장소 (업로드/다운로드/삭제)

### 백엔드 연동 완료
- [x] 대시보드 통계 (`GET /admin/stats`)
- [x] 일일 출퇴근 현황 (`GET /admin/daily-attendance`)
- [x] 월간 통계 조회 (`GET /admin/monthly-stats`)
- [x] 월간 통계 재계산 (`POST /admin/monthly-stats/calculate`)
- [x] 월간 통계 수동 수정 (`PATCH /admin/monthly-stats`)
- [x] 결근/지각 알림 (`GET /admin/absence-alerts`)
- [x] 비고 업데이트 조회 (`GET /admin/note-updates`)
- [x] 비고 업데이트 읽음 처리 (`PATCH /admin/note-updates/dismiss`)
- [x] 기업 문의 조회/처리 (`GET/PATCH /inquiries`)
- [x] 더미 데이터 제거

### 백엔드 연동 완료
- [x] 회원사 CRUD API (GET/POST/PATCH /companies, Company Files)
- [x] 파일 업로드/다운로드 API (Employee Files, Company Files)
- [x] 리포트 탭 파일 저장소 (Admin Files: 문서 템플릿 + 통계 리포트)

### 개선 예정
- [ ] 인쇄 기능 고도화 (현재 `window.print()` 사용 중)

---

## 상세 페이지 기능 명세

### 회원사 상세 페이지 (`/admin/companies/[id]`)

> 파일: `app/admin/companies/[id]/page.tsx` + `_components/` (6개) + `_hooks/` (2개)

#### 레이아웃

3열 반응형 그리드:
- **좌측 (1/3)**: 기업 프로필, 연락처, PM 정보
- **우측 (2/3)**: 소속 근로자 목록, 첨부파일

#### 섹션 구성

| 섹션 | 설명 | 편집 가능 |
|------|------|----------|
| 기업 프로필 카드 | 기업명, 상태 배지(활성/탈퇴), 사업자등록번호 | - |
| 기업 기본 정보 | 주소, 계약 시작일, 기업 고유 번호, 등록일 | - |
| 인사담당자 정보 | 담당자명, 연락처, 이메일 | O (인라인) |
| PM 담당자 정보 | 이름, 전화번호, 이메일 (복사 버튼) | O (인라인) |
| 기업 탈퇴 | 탈퇴 처리 버튼 (조건부 표시) | O (모달) |
| 소속 근로자 | 근로자 테이블 (이름, 전화번호, 입사일, 장애유형, 고유번호) | - |
| 첨부파일 | 문서 목록 + 드래그&드롭 업로드 | O (업로드/삭제) |

#### 인라인 편집

- **기업 정보 편집** (`isEditing`): 주소, HR 담당자 이름/연락처/이메일 → 저장/취소 버튼
- **PM 정보 편집** (`isEditingPm`): PM 이름/전화/이메일 → 저장/취소 버튼

#### 모달

- **기업 탈퇴 모달**: 탈퇴일(필수, date picker) + 탈퇴 사유(textarea, 선택)

#### API 연동

```
getCompany(id)                    → 기업 상세 조회
getEmployees({ companyId: id })   → 소속 근로자 목록
getCompanyFiles(id)               → 첨부파일 목록
updateCompany(id, {...})          → 기업 정보 수정 (HR, PM, 탈퇴)
uploadCompanyFile(id, file)       → 파일 업로드
deleteCompanyFile(id, fileId)     → 파일 삭제
```

#### 주요 기능

- **파일 관리**: 드래그&드롭 또는 클릭 업로드, 파일 조회/다운로드/삭제, 파일 크기 표시
- **이메일 복사**: PM 이메일 클립보드 복사 + 체크 아이콘 피드백 (2초)
- **네비게이션**: 우상단 X 버튼 → `router.back()`, 에러 시 "목록으로 돌아가기"
- **로딩 상태**: 페이지 스피너, 파일 업로드 스피너, 저장 버튼 비활성화

---

### 근로자 상세 페이지 (`/admin/employees/[id]`)

> 파일: `app/admin/employees/[id]/page.tsx` + `_components/` (10개) + `_hooks/` (3개)

#### 레이아웃

3열 반응형 그리드:
- **좌측 (1/3)**: 프로필, 개인정보, 장애정보, 비고
- **우측 (2/3)**: 출퇴근 기록, 근무정보, 문서 관리

#### 섹션 구성

| 섹션 | 설명 | 편집 가능 |
|------|------|----------|
| 프로필 카드 | 이름, 이니셜 아바타, 장애유형, 상태 배지 | - |
| 소속 회사 | 회사명 표시 | - |
| 개인정보 | 고유번호, 전화번호, 비상연락처, 성별, 입사일 | - |
| 장애 정보 | 장애유형, 중증도(중증/경증 배지), 인정일 | - |
| 기업 비고 | 기업이 작성한 메모 (읽기 전용, 파란 박스) | - |
| 관리자 비고 | 관리자 메모 (textarea) | O (인라인) |
| 퇴사 정보 | 퇴사일, 퇴사 사유 (비활성 직원만 표시) | - |
| 최근 출퇴근 기록 | 최근 7건 테이블 (날짜, 출근, 퇴근, 상태, 업무내용, 수정) | O (모달) |
| 근무 정보 | 근무요일 (7일 토글), 출근시간 | O (인라인) |
| 문서 관리 | 문서 목록 + 업로드 모달 | O (업로드/삭제) |

#### 인라인 편집

- **관리자 비고** (`isEditingNotes`): textarea 토글 → 저장/취소 버튼
- **근무 정보** (`isEditingWorkInfo`): 요일 체크박스 7개 + 출근시간 time picker → 저장/취소 버튼

#### 모달

| 모달 | 설명 |
|------|------|
| 근무시간 수정 | 출근/퇴근 시간 수정 + 업무내용 textarea + 상태 드롭다운 (출근/퇴근/결근/휴가) |
| 업무내용 확인 | 특정 날짜 업무내용 읽기 전용 |
| 파일 업로드 | 문서유형 드롭다운 (7종) + 파일 선택 (.pdf, .jpg, .jpeg, .png, 최대 10MB) |

#### 출퇴근 상태 표시

| 상태 | 표시 라벨 | 배지 색상 |
|------|---------|---------|
| checkout (정상) | 정상 | 초록 |
| checkout (지각) | 지각 | 노랑 |
| leave | 휴가 | 파랑 |
| absent | 결근 | 빨강 |
| checkin | 근무중 | 초록 |
| pending | 출근전 | 회색 |

#### API 연동

```
getEmployee(employeeId)                         → 근로자 상세 조회
attendanceApi.getAttendances({ employeeId })    → 최근 출퇴근 기록 (10건)
getEmployeeFiles(employeeId)                    → 문서 목록
updateEmployee(employeeId, {...})               → 관리자 비고, 근무요일, 출근시간 수정
attendanceApi.updateAttendance(id, {...})       → 출퇴근 기록 수정 (시간, 상태, 업무내용)
uploadEmployeeFile(employeeId, file, docType)   → 문서 업로드
deleteEmployeeFile(employeeId, fileId)          → 문서 삭제
```

#### 주요 기능

- **시간대 처리**: `formatUtcTimestampAsKST()`, `formatDateAsKST()`, `buildKSTTimestamp()` 사용
- **근무요일 선택**: 읽기 모드에서 7일 행 표시, 편집 모드에서 토글 버튼
- **문서 유형 분류**: 근로계약서, 동의서, 건강검진, 자격증, 장애인등록증, 이력서, 기타
- **상태 변경**: 근무시간 수정 모달에서 상태 드롭다운으로 출근/퇴근/결근/휴가 선택 가능, 변경 시 프로필 카드 상태 자동 갱신
